<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OrgGraph</title>
  <link rel="stylesheet" href="./style.css" />
  <script src="https://cdn.jsdelivr.net/npm/d3@7/dist/d3.min.js"></script>
</head>
<body>
  <header class="app-header">
    <div class="app-header-main">
      <h1>OrgGraph</h1>
      <div id="combo" class="combo">
        <input id="comboInput" autocomplete="off" placeholder="Suchen… (Name oder ID)" />
        <ul id="comboList" class="combo-list" hidden></ul>
      </div>
    </div>
    <div class="controls">
      <input id="depth" type="number" min="0" max="6" value="2" step="1" inputmode="numeric" />
      
      <div class="direction-toggle" id="directionToggle">
        <button data-dir="both" class="active" title="Beide Richtungen">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M7 17l5 5 5-5"/>
            <path d="M7 7l5-5 5 5"/>
            <path d="M12 2v20"/>
          </svg>
        </button>
        <button data-dir="down" title="Abwärts">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M7 13l5 5 5-5"/>
            <path d="M12 8v10"/>
          </svg>
        </button>
        <button data-dir="up" title="Aufwärts">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M7 11l5-5 5 5"/>
            <path d="M12 6v10"/>
          </svg>
        </button>
      </div>
      
      <button id="toggleManagement" class="toggle-btn active" title="Management">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <!-- Organigramm mit Person Symbol und kleineren Kreisen unten -->
          <circle cx="12" cy="6" r="4" />
          <path d="M12 10v4" />
          <circle cx="6" cy="20" r="1.5" />
          <circle cx="12" cy="20" r="1.5" />
          <circle cx="18" cy="20" r="1.5" />
          <path d="M12 14h-6v4" />
          <path d="M12 14h6v4" />
        </svg>
      </button>
      
      <button id="toggleHierarchy" class="toggle-btn active" title="Hierarchie">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <!-- Hierarchie-Symbol mit 4 vertikalen Linien -->
          <path d="M12 4v8" />
          <path d="M4 12v8" />
          <path d="M12 12v8" />
          <path d="M20 12v8" />
          <path d="M4 12h16" />
        </svg>
      </button>
      
      <button id="toggleLabels" class="toggle-btn active" title="Namen anzeigen">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <!-- Tag-Symbol, das mehr wie ein klassisches Tag aussieht -->
          <path d="M19 16l-5 5a2 2 0 0 1-2.83 0L2 12V4h8l9 9a2 2 0 0 1 0 3z" />
  <circle cx="7" cy="9" r="1.5" />
        </svg>
      </button>
      
      <button id="fit" class="toggle-btn" aria-label="Auf Seite einpassen" title="Auf Seite einpassen">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor">
          <!-- Vollbild-Symbol mit kürzeren diagonalen Pfeilen -->
          <path d="M5 5l3 3" />
          <path d="M5 5H8" />
          <path d="M5 5V8" />
          
          <path d="M19 5l-3 3" />
          <path d="M19 5h-3" />
          <path d="M19 5v3" />
          
          <path d="M5 19l3-3" />
          <path d="M5 19h3" />
          <path d="M5 19v-3" />
          
          <path d="M19 19l-3-3" />
          <path d="M19 19h-3" />
          <path d="M19 19v-3" />
        </svg>
      </button>
      
      <button id="exportBtn" class="toggle-btn" aria-label="Grafik exportieren" title="Grafik exportieren">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <!-- Download/Export-Symbol -->
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
          <polyline points="7 10 12 15 17 10" />
          <line x1="12" y1="15" x2="12" y2="3" />
        </svg>
      </button>
    </div>
  </header>
  <main class="viewport">
    <div class="canvas">
      <svg id="graph" width="100%" height="100%" preserveAspectRatio="xMidYMid meet"></svg>
    </div>
    <aside id="legendPane" aria-label="Organisationseinheiten">
      <div class="legend-section">
        <div class="legend-header">
          <div class="legend-header-layout">
            <div class="legend-collapse-area">
              <button class="legend-chevron expanded" data-target="legend" aria-label="Ein-/Ausklappen">
                <!-- SVG wird durch JavaScript gesetzt -->
              </button>
              <h2 class="legend-title">OEs</h2>
            </div>
            <div class="legend-actions-area">
              <div class="legend-search-container" data-ignore-header-click="true">
                <input type="text" id="oeFilter" placeholder="OE filtern..." class="legend-search-input" data-ignore-header-click="true">
                <button class="legend-icon-btn" id="oeFilterBtn" title="OE filtern" data-ignore-header-click="true">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 300">
                    <path d="M38 66Q38 62 40.5 59.0Q43 56 47 56H253Q257 56 260.0 59.0Q263 62 263.0 66.0Q263 70 260.0 72.5Q257 75 253 75H47Q43 75 40.5 72.5Q38 70 37 66ZM75 141Q75 137 77.5 134.0Q80 131 84 131H216Q220 131 222.5 134.0Q225 137 225.0 141.0Q225 145 222.5 147.5Q220 150 216 150H84Q80 150 77.5 147.5Q75 145 75 141ZM113 216Q112 212 115.0 209.0Q118 206 122 206H178Q182 206 185.0 209.0Q188 212 187.5 216.0Q187 220 184.5 222.5Q182 225 178 225H122Q118 225 115.0 222.5Q112 220 112 216Z" fill="currentColor"/>
                  </svg>
                </button>
              </div>
              <button id="toggleOesVisibility" class="legend-icon-btn active" title="OEs ausblenden" data-ignore-header-click="true">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 300">
                  <path d="M56 162Q55 166 51.5 167.5Q48 169 43.5 168.0Q39 167 38 162Q37 159 38 157L43 144Q50 129 60 116Q75 98 94 88Q119 75 150.0 75.0Q181 75 206 88Q225 98 240 116Q250 129 257 144L262 157Q263 161 261.0 164.0Q259 167 255.5 168.0Q252 169 248.5 167.5Q245 166 244 162L240 152Q234 139 226 128Q213 113 197 104Q176 94 150.0 94.0Q124 94 103 104Q87 113 74 128Q66 139 60 152ZM150 131Q131 131 117.0 145.0Q103 159 103.0 178.5Q103 198 117.0 211.5Q131 225 150.0 225.0Q169 225 183.0 211.5Q197 198 197.0 178.5Q197 159 183.0 145.0Q169 131 150 131ZM122 178Q122 166 130.0 158.0Q138 150 150.0 150.0Q162 150 170.0 158.0Q178 166 178.0 178.0Q178 190 170.0 198.0Q162 206 150.0 206.0Q138 206 130.0 198.0Q122 190 122 178Z" fill="currentColor"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
        <div id="legend" class="legend-content"></div>
      </div>
      
      <div class="legend-section">
        <div class="legend-header">
          <div class="legend-header-layout">
            <div class="legend-collapse-area">
              <button class="legend-chevron expanded" data-target="attributeContainer" aria-label="Ein-/Ausklappen">
                <!-- SVG wird durch JavaScript gesetzt -->
              </button>
              <h2 class="legend-title">Attribute</h2>
            </div>
            <div class="legend-actions-area">
              <button id="loadAttributes" class="legend-icon-btn" title="Attributliste laden" data-ignore-header-click="true">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 300">
                  <path d="M150 56Q127 56 110.5 72.5Q94 89 94 112Q94 116 91.0 119.0Q88 122 84 122H80Q62 122 50.0 134.5Q38 147 38.0 164.5Q38 182 50.0 194.0Q62 206 80 206H94Q95 216 98 225H80Q63 225 49.0 217.0Q35 209 27.0 195.0Q19 181 19 164Q19 140 35.5 122.5Q52 105 76 103Q79 75 100.0 56.0Q121 37 149.0 37.0Q177 37 197.5 54.0Q218 71 223 97Q213 95 203 94Q197 77 182.5 66.5Q168 56 150 56ZM281 197Q281 220 270.0 239.5Q259 259 239.5 270.0Q220 281 197.0 281.0Q174 281 154.5 270.0Q135 259 123.5 239.5Q112 220 112.5 197.0Q113 174 124.0 154.5Q135 135 154.5 123.5Q174 112 197.0 112.5Q220 113 239.5 124.0Q259 135 270.0 154.5Q281 174 281 197ZM190 153 153 190Q150 193 150.0 197.0Q150 201 152.5 203.5Q155 206 159.0 206.0Q163 206 166 204L188 182V234Q188 238 190.5 241.0Q193 244 197.0 244.0Q201 244 203.5 241.0Q206 238 206 234V182L228 204Q230 206 234.0 206.0Q238 206 241.0 203.5Q244 201 244.0 197.0Q244 193 241 190L204 153Q202 151 200.5 150.5Q199 150 197 150Q195 150 193.5 150.5Q192 151 190 153Z" fill="current
                  olor"/>
                </svg>
              </button>
              <button id="toggleAttributesVisibility" class="legend-icon-btn active" title="Attribute ausblenden" data-ignore-header-click="true">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 300">
                  <path d="M56 162Q55 166 51.5 167.5Q48 169 43.5 168.0Q39 167 38 162Q37 159 38 157L43 144Q50 129 60 116Q75 98 94 88Q119 75 150.0 75.0Q181 75 206 88Q225 98 240 116Q250 129 257 144L262 157Q263 161 261.0 164.0Q259 167 255.5 168.0Q252 169 248.5 167.5Q245 166 244 162L240 152Q234 139 226 128Q213 113 197 104Q176 94 150.0 94.0Q124 94 103 104Q87 113 74 128Q66 139 60 152ZM150 131Q131 131 117.0 145.0Q103 159 103.0 178.5Q103 198 117.0 211.5Q131 225 150.0 225.0Q169 225 183.0 211.5Q197 198 197.0 178.5Q197 159 183.0 145.0Q169 131 150 131ZM122 178Q122 166 130.0 158.0Q138 150 150.0 150.0Q162 150 170.0 158.0Q178 166 178.0 178.0Q178 190 170.0 198.0Q162 206 150.0 206.0Q138 206 130.0 198.0Q122 190 122 178Z" fill="currentColor"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
        <div id="attributeContainer" class="legend-content">
          <input type="file" id="attributeFileInput" accept=".txt,.csv,text/plain,text/csv,text/tab-separated-values" hidden />
          <div id="attributeLegend" class="attribute-legend">
            <!-- Dynamisch generierte Attribut-Legende -->
          </div>
        </div>
      </div>
      
      <div class="legend-section">
        <div class="legend-header">
          <div class="legend-header-layout">
            <div class="legend-collapse-area">
              <button class="legend-chevron expanded" data-target="hiddenLegend" aria-label="Ein-/Ausklappen">
                <!-- SVG wird durch JavaScript gesetzt -->
              </button>
              <h2 class="legend-title">Ausgeblendet</h2>
            </div>
            <div class="legend-actions-area">
              <!-- Platzhalter für Konsistenz -->
            </div>
          </div>
        </div>
        <div id="hiddenLegend" class="legend-content"></div>
      </div>
    </aside>
  </main>
  <footer class="app-footer">
    <div class="footer-stats">
      <span id="status">Bereit</span>
      <span class="stat-separator">|</span>
      <span id="stats-loaded">Geladen: <strong id="stats-nodes-total">0</strong> Knoten, <strong id="stats-links-total">0</strong> Kanten, <strong id="stats-orgs-total">0</strong> OEs</span>
      <span class="stat-separator">|</span>
      <span id="stats-visible">Sichtbar: <strong id="stats-nodes-visible">0</strong> Knoten, <strong id="stats-links-visible">0</strong> Kanten</span>
      <span class="stat-separator">|</span>
      <span id="stats-orgs-display">Aktive OEs: <strong id="stats-orgs-count">0</strong></span>
      <span class="stat-separator">|</span>
      <span id="stats-attributes">Attribute: <strong id="stats-attributes-count">0</strong></span>
    </div>
  </footer>
  <script src="./export.js"></script>
  <script src="./app.js"></script>
  
  <!-- Export Dialog -->
  <div id="exportModal" class="modal" style="display:none;">
    <div class="modal-overlay"></div>
    <div class="modal-container">
      <div class="modal-header">
        <h2>Grafik exportieren</h2>
        <button class="modal-close-btn">&times;</button>
      </div>
      <div class="modal-content">
        <div class="export-options">
          <div class="export-option-group">
            <h3>Format</h3>
            <div class="radio-group">
              <label>
                <input type="radio" name="exportFormat" value="svg" checked>
                <span>SVG</span>
              </label>
              <label>
                <input type="radio" name="exportFormat" value="png">
                <span>PNG</span>
              </label>
            </div>
          </div>
          
          <div id="svgOptions" class="export-option-group">
            <button id="downloadSvg" class="export-btn">SVG herunterladen</button>
          </div>
          
          <div id="pngOptions" class="export-option-group" style="display:none;">
            <h3>Auflösung</h3>
            <div class="resolution-options">
              <div class="resolution-presets">
                <button class="resolution-preset" data-width="1200" data-height="800">1200 × 800</button>
                <button class="resolution-preset" data-width="1920" data-height="1080">1920 × 1080</button>
                <button class="resolution-preset" data-width="2560" data-height="1440">2560 × 1440</button>
                <button class="resolution-preset" data-width="3840" data-height="2160">3840 × 2160</button>
              </div>
              <div class="custom-resolution">
                <h4>Benutzerdefiniert</h4>
                <div class="resolution-inputs">
                  <div class="resolution-input-group">
                    <label for="customWidth">Breite</label>
                    <input type="number" id="customWidth" value="1200" min="100" max="10000">
                  </div>
                  <div class="resolution-input-group">
                    <label for="customHeight">Höhe</label>
                    <input type="number" id="customHeight" value="800" min="100" max="10000">
                  </div>
                </div>
              </div>
            </div>
            <h3>Qualität</h3>
            <div class="quality-slider">
              <input type="range" id="qualitySlider" min="1" max="4" step="0.5" value="2">
              <div class="quality-labels">
                <span>Schneller</span>
                <span>Besser</span>
              </div>
            </div>
            <button id="downloadPng" class="export-btn">PNG herunterladen</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
